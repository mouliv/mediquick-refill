<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MediQuickRx - Prescription Refill</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background-color: #f7f9fc;
    color: #333;
  }
  header {
    background-color: #005eb8;
    color: white;
    padding: 20px;
    text-align: center;
  }
  header h1 {
    margin: 0;
    font-size: 2rem;
  }
  nav {
    background-color: #003f7d;
    padding: 10px;
    text-align: center;
  }
  nav a {
    color: white;
    margin: 0 15px;
    text-decoration: none;
    font-weight: bold;
  }
  .container {
    max-width: 900px;
    margin: 20px auto;
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  h2 {
    color: #005eb8;
    border-bottom: 2px solid #eee;
    padding-bottom: 10px;
  }
  form label {
    display: block;
    margin: 12px 0 6px;
    font-weight: bold;
  }
  form input, form select {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  form button {
    background-color: #005eb8;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
    cursor: pointer;
  }
  form button:hover {
    background-color: #004080;
  }
  .confirmation {
    display: none;
    margin-top: 15px;
    padding: 12px;
    background: #d4edda;
    color: #155724;
    border-radius: 5px;
    border: 1px solid #c3e6cb;
  }
  .products {
    margin-top: 40px;
  }
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
  }
  .product-card {
    background: #fff;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: transform 0.2s;
  }
  .product-card:hover {
    transform: translateY(-5px);
  }
  .product-card img {
    max-width: 100px;
    border-radius: 8px;
    margin-bottom: 10px;
  }
  footer {
    background-color: #003f7d;
    color: white;
    text-align: center;
    padding: 15px;
    margin-top: 40px;
  }
</style>
</head>
<body>

<header>
  <h1>MediQuickRx</h1>
  <p>Your trusted partner in healthcare</p>
</header>

<nav>
  <a href="#">Home</a>
  <a href="#">Refill</a>
  <a href="#">Products</a>
  <a href="#">Contact</a>
</nav>

<div class="container">
  <h2>Refill Your Prescription</h2>
  <form id="refillForm">

    <label for="customerId">Customer ID</label>
    <input type="text" id="customerId" name="customerId" placeholder="Enter your Customer ID" required>

    <label for="drugName">Medication Name</label>
    <input list="medications" id="drugName" name="drugName" placeholder="Search medication...">
    <datalist id="medications">
      <option value="Lipitor">
      <option value="Metformin">
      <option value="Amoxicillin">
      <option value="Tylenol">
      <option value="Ativan">
      <option value="Zoloft">
      <option value="Crestor">
    </datalist>

    <label for="dosage">Dosage</label>
    <select id="dosage" name="dosage">
      <option>10mg</option>
      <option>20mg</option>
      <option>50mg</option>
      <option>100mg</option>
    </select>

    <label for="pickupDate">Pickup Date</label>
    <input type="date" id="pickupDate" name="pickupDate">

    <label for="refillSupply">Refill Required (days)</label>
    <input type="number" id="refillSupply" name="refillSupply" min="1" max="90" required>

    <label for="location">Pickup Location</label>
    <select id="location" name="location">
      <option value="downtown">Downtown Pharmacy - 123 Main St</option>
      <option value="uptown">Uptown Pharmacy - 456 Oak Ave</option>
      <option value="suburb">Suburb Pharmacy - 789 Pine Rd</option>
    </select>

    <label for="prescription">Doctor Prescription (Upload)</label>
    <input type="file" id="prescription" name="prescription">

    <button type="submit">Submit Refill Request</button>
  </form>

  <!-- Confirmation Message -->
  <div class="confirmation" id="confirmationMessage"></div>
</div>

<!-- Featured Products -->
<section class="products container">
  <h2>Featured Products</h2>
  <div class="product-grid">
    <div class="product-card">
      <img src="https://cdn.pixabay.com/photo/2016/11/18/16/46/pills-1839518_1280.jpg" alt="Lipitor">
      <h3>Lipitor</h3>
      <p>Helps manage cholesterol levels.</p>
    </div>
    <div class="product-card">
      <img src="https://cdn.pixabay.com/photo/2014/12/29/15/37/pills-583773_1280.jpg" alt="Metformin">
      <h3>Metformin</h3>
      <p>Trusted medication for diabetes management.</p>
    </div>
    <div class="product-card">
      <img src="https://cdn.pixabay.com/photo/2018/01/26/18/15/medicine-3113661_1280.jpg" alt="Amoxicillin">
      <h3>Amoxicillin</h3>
      <p>Effective antibiotic for infections.</p>
    </div>
    <div class="product-card">
      <img src="https://cdn.pixabay.com/photo/2016/11/29/12/54/medications-1867066_1280.jpg" alt="Tylenol">
      <h3>Tylenol</h3>
      <p>Relief from pain and fever.</p>
    </div>
  </div>
</section>

<footer>
  <p>&copy; 2025 MediQuickRx. All Rights Reserved.</p>
</footer>

<!-- Chat Bubble -->
<div id="divicw" data-bind="EF621F57-FB8D-4001-9C02-12388B88459B" data-org=""></div><script>var i={t:function(t){var e="https://media.imi.chat/widget/js/imichatinit.js";try{var o=new XMLHttpRequest;o.onreadystatechange=function(){if(this.readyState==4){var t=document.getElementById("divicw");if(this.status==0){i.o(t);return}var e=document.createElement("script");e.innerHTML=this.responseText;t.parentNode.insertBefore(e,t.nextSibling)}};o.open("GET",e,true);o.send()}catch(s){console.error(s)}},o:function(t){t.insertAdjacentHTML("afterend",'<iframe id="tls_al_frm" frameborder="0" style="overflow: hidden;height: 208px;width: 394px;position: fixed;display: block;right: 48px;bottom: 12px;z-index: 99999; display:none;"></iframe>');var e=document.getElementById("tls_al_frm");var o=e.contentWindow||(e.contentDocument.document||e.contentDocument);o.document.open();o.document.write('<!doctype html><html><head><meta charset="utf-8"><title>Untitled Document</title><style>body{font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;color: #99a0b0;font-size: 14px;}.popover__content{background-color: #fbfbfe; padding: 1.5rem; border-radius: 5px; width: 300px; box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);position: relative;}.popover__message{font-weight: 600;color:#56627c;font-size: 16px;}.pull-left{float:left;}.clearfix{clear: both;}.hdr-txt{width: 218px; margin-top: 3px;}.para-txt a{text-decoration: none;color: #005cde;}.close-btn{position: absolute;right:15px;top:15px;}.close-btn a{text-decoration: none;font-weight: 400; color: #56627c; font-size: 16px;}</style></head><body><div class="popover__content"><div class="close-btn"><a href="#" onclick="closeTLSAlert();">X</a></div><div class="popover__message"><div class="pull-left hdr-txt">This browser version is not supported on LiveChat.</div></div><div class="clearfix"></div><p class="para-txt">Please update your browser to the latest version and re-open the website to access the widget. </p></div><script>function closeTLSAlert(){window.parent.postMessage({key: "close_tls_alert",value: "close_tls_alert",action: "close_tls_alert"}, "*");}<\/script></body></html>');o.document.close();e.style.display="block";window.addEventListener("message",function(t){if(t.data.action=="close_tls_alert"){i.s()}})},s:function(){var t=document.getElementById("tls_al_frm");t.remove()}};i.t(function(t){});</script>


<!-- JavaScript for conditional fulfillment and WxCC API -->
<script>
const form = document.getElementById('refillForm');
const confirmation = document.getElementById('confirmationMessage');

form.addEventListener('submit', function(e) {
  e.preventDefault(); // prevent default form submission

  // Collect form values
  const formData = {
    customerId: document.getElementById('customerId').value,
    drugName: document.getElementById('drugName').value,
    dosage: document.getElementById('dosage').value,
    pickupDate: document.getElementById('pickupDate').value,
    refillSupply: document.getElementById('refillSupply').value,
    location: document.getElementById('location').value
  };

  // Determine fulfillment message based on refillSupply
  let fulfillmentMessage = "";
  if (parseInt(formData.refillSupply) === 3) {
    fulfillmentMessage = "✅ Your refill request is successful!";
  } else if (parseInt(formData.refillSupply) === 5) {
    fulfillmentMessage = "❌ Fulfillment failed. Please call us at 1800RxFILL or chat with us on this page.";
  } else {
    fulfillmentMessage = "Your refill request is being processed.";
  }

  // Show fulfillment message in the UI
  confirmation.style.display = 'block';
  confirmation.innerText = fulfillmentMessage;

  // Construct CloudEvent for WxCC including fulfillment message
  const wxccEvent = {
    id: crypto.randomUUID(),
    specversion: "1.0",
    type: "MedicineEntered",
    source: "PharmacyWebForm",
    identity: formData.customerId,
    identitytype: "customerId",
    datacontenttype: "application/json",
    data: {
      customerId: formData.customerId,
      medicineName: formData.drugName,
      dosage: formData.dosage,
      pickupDate: formData.pickupDate,
      refillSupply: formData.refillSupply + " days",
      location: formData.location,
      fulfillmentMessage: fulfillmentMessage
    }
  };

  // Send API call to WxCC
  fetch('https://api.wxcc-us1.cisco.com/publish/v1/api/event?workspaceId=65171e0682b7f52b9209b39d', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer YzExYzZhMDEtYmQxNy00ODZiLWE4NDQtODNlMTcxZGJiMWIwZThlMjliZGYtNTZh_P0A1_e56f00d4-98d8-4b62-a165-d05a41243d98' // replace with real token
    },
    body: JSON.stringify(wxccEvent)
  })
  .then(response => response.json())
  .then(data => {
    console.log('WxCC Response:', data);
  })
  .catch(error => {
    console.error('Error sending to WxCC:', error);
  });
});
</script>
</body>
</html>
